#!/usr/bin/env julia

using DocOpt
using Lumberjack

include("../src/inference.jl")

add_truck(LumberjackTruck("mp-biopath.log"), "file-logger")

doc = """MP-BioPath.

Usage:
  mp-biopath inference --config=<file> [-verbose]
  mp-biopath -h | --help
  mp-biopath --version

Options:
  --config <file>  Configuration file to use for run 
  -h --help        Show this screen.
  -v -verbose      Verbose output
  --version        Show version.
"""

arguments = docopt(doc, version=v"1.0.3")

configFile = arguments["--config"]

verbose = arguments["-v"]

if (verbose)
   dump(configFile)
end

if (!isfile(configFile))
   info("ERROR: Config file not found")
   exit(1)
end

if (verbose)
    info("Parsing config file: $configFile")
end

import YAML
config = YAML.load(open(configFile))

if (verbose)
  dump(config)
end

function main()
    if arguments["inference"]
       if (verbose)
           info("Inference Selected")
       end
       Inference.run(configFile, config, verbose)
    end
end

main()

