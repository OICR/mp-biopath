[![Build Status](https://travis-ci.org/OICR/mp-biopath.svg?branch=develop)](https://travis-ci.org/OICR/mp-biopath)

# MP-BioPath 

A command line tool for modelling the effects of perterbations on biological pathways.

For a full user guide please refer to the following [document](https://oicr.gitbooks.io/mp-biopath-documentation/content/)

# Installation

## Julia (http://julialang.org/)

### Linux

```bash
apt-get install julia
```

## Dependencies 

This will install all the Julia modules that the tool relies on

```bash
make install
```

## Running Inference

```bash
./bin/pgmlab --help
```

# Install TSNe package

First enter Julia console

```bash
julia
```

In Julia console install

``julia
Pkg.clone("git://github.com/lejon/TSne.jl.git")
```


# Downloading Expression Data

```bash
curl -o data/expression-data.tsv https://www.ebi.ac.uk/gxa/experiments/E-MTAB-2836.tsv?geneQuery=%5B%7B%22value%22%3A%22protein_coding%22%2C%22category%22%3A%22gene_biotype%22%7D%5D
```

## Gene to uniprot mapping

This was created through the uniprot user interfaces. A list of Ensemble IDs, from the expression data, were provided and mapped to UniProt ids (http://www.uniprot.org/)

Results were saved to data/Expression_Atlas_ENSEMBL_gene_to_UniProt_mapping.txt


## Essential Genes source
http://ogee.medgenius.info/browse/

## Convert gene names to HUGO

http://useast.ensembl.org/Help/Faq?id=125

Used biomart central to download a list of HUGO gene symbols to match the ensemble geneIDs. The exact query can be found in the script "get_gene_id_mapping_from_biomart_central.pl" that was generated by Biomart Central.
 
# Got list of unique genes with following command

```bash
grep -v "TextMining" essential_9606_all.txt | awk -F"\t" '$4 == "E" { print $3 }' | sort | uniq > essential_9606_all_gene_ids.txt
```
## Synthetically lethal 

The two files sl_human and sdl_human were downloaded from: http://histone.sce.ntu.edu.sg/SynLethDB/downloadPage.php

And more information about the data can be found in the following articles:
- https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4445436/ "The authors also analyzed synthetic dosage lethality (SDL), which is the overexpression of a gene that leads to the essentiality of a second gene, making a SDL pair"
- http://nar.oxfordjournals.org/content/early/2015/10/29/nar.gkv1108.full 

## Coexpression Data

http://coxpresdb.jp/download.shtml

##Coespression DB API

http://coxpresdb.jp/help/API.shtml

## Test 

```bash
julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways\ where\ negative\ OR\ is\ AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt ~/git/PGM/InputDataForTesting/Mock_Short_Input_Data_for_PIP3_Activates_AKT_Signaling_Text.txt --key-outputs
```bash

## Find SI
```bash
julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways\ where\ negative\ OR\ is\ AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt --find-si --key-outputs
```

## Get unique SI Pairs
```bash
cut -f2,4 PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt.si | sort | uniq  > PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt.si.uniq
```

## test commands

```bash
time julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways_where_negative_OR_is_AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt --find-si
```

```bash
julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways_where_negative_OR_is_AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt --analyze-known-si-list
```

```bash
julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways_where_negative_OR_is_AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt ~/git/PGM/InputDataForTesting/Mock_Short_Input_Data_for_PIP3_Activates_AKT_Signaling_Text.txt
```

### inspecting results from observation file
```bash
julia scripts/analyzeBioNetwork.jl ~/git/PGM/Pathways_where_negative_OR_is_AND/PIP3_activates_AKT_signaling_Sept23_2016_sorted_checked_patched_1_NegativeORtoAND.txt ~/git/PGM/InputDataForTesting/Mock_Short_Input_Data_for_PIP3_Activates_AKT_Signaling_Text.txt <results-file> ~/git/PGM/Expected_results_for_mock_input_data/PIP3_activates_AKT_signaling_Expected_Results_for_Mock_input_Data.csv
```

### Making Environment container

```bash
make build-env
```

### Run Development

```bash
docker run -v`pwd`:/app --env JULIA_LOAD_PATH=/app/src/ -it  oicr/mpbiopath-env:0.0.4-SNAPSHOT /bin/bash
```

### create Tsne Plot

1) start interactive server
2) Start julia repl

```bash
julia
```

3) Install tsne package

```julia
Pkg.clone("git://github.com/lejon/TSne.jl.git")
```

4) Exit repl

```julia
exit()
```

4) Run tsne command

Make sure the subgroup\_label is the name of the column that you are using to categorize the rows

```bash
julia scripts/create_tsne_plot.jl haveheader --labelcolname=subgroup_label /data/gecco/mpbiopath_results.summary.observation.subgroup.tsv
```

This will generate a file in working directory called Plot2.png.

5) Move image to mounted volume 


